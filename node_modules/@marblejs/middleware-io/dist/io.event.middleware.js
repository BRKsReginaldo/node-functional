"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@marblejs/core");
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const io_middleware_1 = require("./io.middleware");
exports.eventValidator$ = (schema, options) => {
    const eventValidator$ = io_middleware_1.validator$(schema, options);
    return (event$) => event$.pipe(operators_1.mergeMap(event => eventValidator$(rxjs_1.of(event.payload)).pipe(operators_1.map(payload => event), operators_1.catchError((error) => rxjs_1.throwError(new core_1.EventError(event, error.message, error.data))))));
};
