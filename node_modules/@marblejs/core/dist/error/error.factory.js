"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const chalk_1 = require("chalk");
const error_model_1 = require("./error.model");
exports.stringifyStackTrace = (stackTrace) => stackTrace
    .map(s => chalk_1.default.gray(`    @ ${s}`))
    .join('\n  ');
exports.coreErrorStackTraceFactory = (opts) => (message, stack) => {
    const [method, file, ...restStack] = stack;
    const [line, col] = [file.getLineNumber() || 0, file.getColumnNumber() || 0];
    const packageName = opts.contextPackage || '@marblejs/core';
    const methodName = opts.contextMethod + ' : ' + (method.getMethodName() || '-');
    const fileName = file.getFileName() || '';
    return `
  ${chalk_1.default.red(`${packageName} error:`)}

  ðŸš¨  ${message}

  ðŸ‘‰  ${chalk_1.default.yellow.bold(methodName)}
    @ file: ${chalk_1.default.underline(fileName)}
    @ line: [${line.toString()}:${col.toString()}]

  ${exports.stringifyStackTrace(restStack)}\n`;
};
exports.coreErrorFactory = (message, opts) => new error_model_1.CoreError(message || 'Something is not right...', {
    stackTraceFactory: exports.coreErrorStackTraceFactory(opts),
    context: exports.coreErrorFactory,
});
