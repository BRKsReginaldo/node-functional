"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const operators_1 = require("rxjs/operators");
const http_interface_1 = require("../http.interface");
const error_model_1 = require("./error.model");
const defaultHttpError = new error_model_1.HttpError('Internal server error', http_interface_1.HttpStatus.INTERNAL_SERVER_ERROR);
const getStatusCode = (error) => error_model_1.isHttpError(error)
    ? error.status
    : http_interface_1.HttpStatus.INTERNAL_SERVER_ERROR;
const errorFactory = (status, error) => error_model_1.isHttpError(error)
    ? { error: { status, message: error.message, data: error.data, context: error.context } }
    : { error: { status, message: error.message } };
exports.defaultError$ = (req$, _, meta) => req$
    .pipe(operators_1.mapTo(meta.error || defaultHttpError), operators_1.map(error => {
    const status = getStatusCode(error);
    const body = errorFactory(status, error);
    return { status, body };
}));
